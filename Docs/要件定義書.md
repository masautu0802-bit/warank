# 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
Wa-Rank（ワーランク）

### 1.2 プロジェクトの目的
お笑い芸人の大会成績に基づいたポイントシステムによるランキング管理と、主要大会の予想機能を提供するWebアプリケーション。

### 1.3 対象ユーザー
- お笑いファン
- 芸人ランキングに興味があるユーザー
- 大会予想を楽しみたいユーザー

### 1.4 開発環境
- **フレームワーク**: Next.js 16 (App Router)
- **フロントエンド**: React 19 + TypeScript
- **スタイリング**: Tailwind CSS 4
- **UIコンポーネント**: shadcn/ui (優先使用)
- **アニメーション**: anime.js
- **バックエンド**: Supabase (認証・データベース)
- **グラフライブラリ**: Recharts 3

### 1.5 コンポーネント構成ルール
- **page.tsx / layout.tsx**: サーバーコンポーネントのまま維持
- **クライアントコンポーネント**: アニメーションやイベント処理が必要なコンポーネントは`components/`フォルダに作成
- **'use client'ディレクティブ**: クライアントコンポーネントの先頭に必ず記述
- **アニメーション実装**:
  - anime.jsを使用
  - useEffectでDOMを安全に操作
  - ReactのステートやCSSクラスをanime.jsで直接変更しない
  - transformとopacityを中心に上品で軽い動きを実現

## 2. 機能要件

### 2.1 ランキング機能

#### 2.1.1 芸人ランキング表示
- **機能概要**: 芸人の総獲得ポイントに基づいたランキングを表示
- **表示内容**:
  - ランキング順位
  - 芸人名
  - 総獲得ポイント
  - プロフィール画像
  - トレンド（上昇/下降/安定）
  - 所属事務所
- **表示形式**:
  - ホームページに上位10名をサイドバー表示
  - 全ランキングページで全芸人を表示
  - モバイルでは上位5名を表示

#### 2.1.2 ポイント計算システム
- **基本ポイント**: ティア（S, A, B, C, D, E）と順位に基づく
- **マルチプライヤー**: ティアごとに自動計算（S=10, A=7, B=5, C=3.5, D=2, E=1）
- **シリーズ内ポイント管理**: 同一シリーズ内では最も後のラウンドのみポイントをカウント
- **勝ち抜けポイント**: 順位がつかない大会形式でも、次のラウンドに進出した場合にポイントを付与
- **ノミネート方式**: 最終ラウンドで1位以外は進出ポイント、1位は通常ポイント

#### 2.1.3 属性値計算
- **Power（総合力）**: 偏差値0-100
- **Clutch（決勝力）**: 偏差値0-100
- **Champion（頂点到達力）**: 偏差値0-100
- **Stability（安定感）**: 偏差値0-100
- **Experience（経験値）**: 偏差値0-100

### 2.2 イベント管理機能

#### 2.2.1 イベント一覧表示
- **日付フィルタリング**: 日付スライダーで選択した日付のイベントを表示
- **ティアフィルタリング**: S, A, B, C, D, E のティアでフィルタ可能
- **主要4大会フィルター**: M-1、R-1、THE SECOND、キングオブコントのみ表示
- **イベントカード表示**:
  - イベント名
  - 開催日
  - ティア
  - フォーマット
  - 参加芸人数
  - ステータス（開催前/開催中/終了）

#### 2.2.2 イベント詳細表示
- **基本情報**:
  - イベント名、開催日、ティア、フォーマット
  - 開催場所、視聴方法、観覧方法
  - チケット販売URL（複数可）
  - 賞金、公式URL
- **参加芸人一覧**: 参加芸人とその順位
- **ブロック別対戦結果**: ブロック形式の大会の場合
- **予想タブ**: 予想機能へのリンク

#### 2.2.3 イベント形式対応
- **absolute-judge**: プロ審査員による絶対評価・合計点方式
- **3-choice**: 一般審査員による3択・絶対評価方式
- **block-elimination**: ブロック別勝ち残り・入れ替え方式
- **selection**: 選考式（順位なし）
- **nomination-selection**: ノミネートからの選出

### 2.3 芸人詳細機能

#### 2.3.1 芸人プロフィール表示
- **基本情報**:
  - 芸人名、プロフィール画像
  - ランキング順位、総獲得ポイント
  - 所属事務所、バイオグラフィー
  - トレンド、応援数
- **タブ表示**:
  - **メトリクス**: ランキング、総ポイント、属性値
  - **実績**: 3位以内の大会成績（トロフィー棚）
  - **予定**: 今後の出演予定
  - **分析**: ランキング推移グラフ

#### 2.3.2 パフォーマンス履歴
- 過去の大会成績一覧
- 獲得ポイントの表示
- シリーズ内でのポイント除外理由の表示

### 2.4 予想機能

#### 2.4.1 予想可能なイベント
- **対象**: 主要4大会（M-1、R-1、THE SECOND、キングオブコント）または順位がつかない大会形式
- **予想形式**:
  - **単勝（Winner）**: 1着を予想
  - **3連単（Trifecta）**: 1,2,3着を順位通りに予想
  - **3連複（Quinella）**: 1,2,3着を順不同で予想
  - **ワイド（Wide）**: 3着以内に入る2組を順不同で予想
  - **進出予想（Advancement）**: 次のラウンドに進出する芸人を予想

#### 2.4.2 予想入力機能
- 予想形式の選択
- 芸人の選択（複数可）
- 賭けポイントの設定
- オッズの自動計算
- 予想の保存・編集・削除

#### 2.4.3 予想結果表示
- 的中判定
- 払い戻し額の計算
- 損益の表示
- 的中率の表示
- SNSシェア機能

#### 2.4.4 ポイントシステム
- 初期ポイント: 10,000ポイント
- オッズ計算: 人気度に基づく
- 自動払い戻し:
  - 最終ラウンド以外: 次のラウンド通過時に自動払い戻し
  - 最終ラウンド: 結果確定の翌日に自動払い戻し

### 2.5 ユーザー認証機能

#### 2.5.1 認証方式
- **Supabase Auth**: メール/パスワード認証
- **機能**:
  - ユーザー登録
  - ログイン
  - ログアウト
  - パスワードリセット

#### 2.5.2 ユーザープロフィール
- ユーザー情報の表示
- 予想履歴
- 獲得ポイント残高
- お気に入り芸人・イベント

### 2.6 お気に入り機能
- 芸人をお気に入りに追加/削除
- イベントをお気に入りに追加/削除
- お気に入り一覧の表示

### 2.7 検索機能
- 芸人検索
- イベント検索
- リアルタイム検索

### 2.8 チュートリアル機能
- 初回訪問時のチュートリアル表示
- ページごとのチュートリアル
- チュートリアルのスキップ機能

### 2.9 レスポンシブデザイン
- モバイル対応（スマートフォン）
- タブレット対応
- デスクトップ対応

### 2.10 ダークモード対応
- ライトモード/ダークモードの切り替え
- ユーザー設定の保存

## 3. 非機能要件

### 3.1 パフォーマンス要件
- 初回読み込み時間: 3秒以内
- ページ遷移: 1秒以内
- データ取得: 2秒以内

### 3.2 セキュリティ要件
- ユーザー認証の必須化（予想機能）
- RLS（Row Level Security）によるデータアクセス制御
- 環境変数による機密情報の管理

### 3.3 可用性要件
- データ取得失敗時のフォールバック機能
- エラーハンドリングの実装

### 3.4 保守性要件
- TypeScriptによる型安全性
- コンポーネントの再利用性
- コードの可読性

### 3.5 互換性要件
- 主要ブラウザ対応（Chrome, Firefox, Safari, Edge）
- モバイルブラウザ対応（iOS Safari, Chrome Mobile）

## 4. 制約事項

### 4.1 技術的制約
- Supabaseの無料プランの制限
- ブラウザのストレージ制限（localStorage, sessionStorage）

### 4.2 ビジネス制約
- 予想機能はログイン必須
- 主要4大会のみ予想可能

## 5. 用語定義

### 5.1 ティア
大会の重要度を表すランク（S, A, B, C, D, E）

### 5.2 シリーズ
同一ブランドの複数ラウンドを関連付けるID

### 5.3 ラウンド
シリーズ内の各段階（予選、準決勝、決勝など）

### 5.4 オッズ
予想の的中確率に基づく倍率

### 5.5 払い戻し
的中した予想に対するポイントの返還

## 6. 技術的制約とルール

### 6.1 コンポーネント設計ルール
- **サーバーコンポーネント**: `page.tsx`と`layout.tsx`は常にサーバーコンポーネント
- **クライアントコンポーネント**: インタラクティブな機能（アニメーション、イベント処理）は`components/`フォルダに配置
- **'use client'ディレクティブ**: クライアントコンポーネントの先頭に必須

### 6.2 アニメーション実装ルール
- **ライブラリ**: anime.jsを使用
- **DOM操作**: useEffect内で安全に実行
- **禁止事項**: 
  - Reactのステートをanime.jsで直接変更しない
  - CSSクラスをanime.jsで直接変更しない
- **推奨プロパティ**: transformとopacityを中心に使用
- **動きの方向性**: 上品で軽い動きを心がける

### 6.3 UIコンポーネント
- **優先使用**: shadcn/uiコンポーネント
- **カスタマイズ**: Tailwind CSSでスタイリング
- **一貫性**: デザインシステムに沿った実装

## 7. 参考資料

- README.md
- Next.jsベストプラクティス.md
- 各種セットアップガイド（SUPABASE_*.md）
- マイグレーションファイル（supabase/migrations/*.sql）
